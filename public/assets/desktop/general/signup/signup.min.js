function getURL(){return-1<window.location.href.indexOf("localhost:8081")?"http://localhost:8081/api/":"https://commservus.com/api/"}Date.prototype.addMinutes=function(a){this.setMinutes(this.getMinutes()+a);return this};function getServerTime(){var a=-5,d=new Date;d.dst()&&(a+=1);d=d.getTime()+6E4*d.getTimezoneOffset();return new Date(d+36E5*a)}
Date.prototype.stdTimezoneOffset=function(){var a=new Date(this.getFullYear(),0,1),d=new Date(this.getFullYear(),6,1);return Math.max(a.getTimezoneOffset(),d.getTimezoneOffset())};Date.prototype.dst=function(){return this.getTimezoneOffset()<this.stdTimezoneOffset()};function formatTime(a){return toDouble(a.getHours())+":"+toDouble(a.getMinutes())+":"+toDouble(a.getSeconds())+" "+toDouble(a.getMonth()+1)+"-"+toDouble(a.getDate())+"-"+toDouble(a.getFullYear())}
function getTime(){return formatTime(getServerTime())}function parseTime(a){var d=new Date,c=a.split(" ");a=c[0].split(":");c=c[1].split("-");d.setHours(a[0]);d.setMinutes(a[1]);d.setSeconds(a[2]);d.setMonth(c[0]-1);d.setDate(c[1]);d.setFullYear(c[2]);return d}function toDouble(a){return 9<a?a:"0"+a}
function sendSimpleRequest(a,d,c,e){var b=new XMLHttpRequest;if(-1<window.location.href.indexOf("localhost:8081")){b.open(d.toUpperCase(),getURL()+a);b.setRequestHeader("Content-type","application/json");if("undefined"==typeof c||null==c)try{b.send()}catch(f){}else b.send(JSON.stringify(c));b.onreadystatechange=function(){if(4===b.readyState)if(200===b.status){var a=JSON.parse(b.responseText);e(void 0,a)}else console.log(b.statusText)}}else if("withCredentials"in b){b.open(d,getURL()+a,!0);b.setRequestHeader("Content-type",
"application/json");b.withCredentials=!0;if("undefined"==typeof c||null==c)try{b.send()}catch(f){e(f)}else b.send(JSON.stringify(c));b.onreadystatechange=function(){if(4===b.readyState)if(200===b.status){var a=JSON.parse(b.responseText);e(void 0,a)}else console.log(b.statusText)}}else if("undefined"!=typeof XDomainRequest){b=new XDomainRequest;b.open(d,getURL()+a);b.setRequestHeader("Content-type","application/json");if("undefined"==typeof c||null==c)try{b.send()}catch(f){e(f)}else b.send(JSON.stringify(c));
b.onreadystatechange=function(){if(4===b.readyState)if(200===b.status){var a=JSON.parse(b.responseText);e(void 0,a)}else console.log(b.statusText)}}else e("We can't CORS",response),b=null}
function sendSimpleFileRequest(a,d,c,e){var b=new XMLHttpRequest;if(-1<window.location.href.indexOf("localhost:8081")){b.open(d.toUpperCase(),getURL()+a);if("undefined"==typeof c||null==c)try{b.send()}catch(h){}else{var f=new FormData;for(g in c)c.hasOwnProperty(g)&&f.append(g,c[g]);b.send(f)}b.onreadystatechange=function(){if(4===b.readyState)if(200===b.status){var a=JSON.parse(b.responseText);e(void 0,a)}else console.log(b.statusText)}}else if("withCredentials"in b){b.open(d,getURL()+a,!0);b.withCredentials=
!0;if("undefined"==typeof c||null==c)try{b.send()}catch(h){e(h)}else{var g=new FormData;for(f in c)c.hasOwnProperty(f)&&g.append(f,c[f]);b.send(g)}b.onreadystatechange=function(){if(4===b.readyState)if(200===b.status){var a=JSON.parse(b.responseText);e(void 0,a)}else console.log(b.statusText)}}else if("undefined"!=typeof XDomainRequest){b=new XDomainRequest;b.open(d,getURL()+a);if("undefined"==typeof c||null==c)try{b.send()}catch(h){e(h)}else{formData3=new FormData;for(key3 in c)c.hasOwnProperty(ke3y)&&
formData3.append(key3,c[key3]);b.send(formData3)}b.onreadystatechange=function(){if(4===b.readyState)if(200===b.status){var a=JSON.parse(b.responseText);e(void 0,a)}else console.log(b.statusText)}}else e("We can't CORS",response),b=null}function validateEmail(a){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(a)}
function TimeKeyDelay(){var a=null;(function(d,c,e){c.onkeyup=function(){clearTimeout(a);a=setTimeout(e,d)}}).apply(this,arguments)}var QueryString=function(){for(var a={},d=window.location.search.substring(1).split("&"),c=0;c<d.length;c++){var e=d[c].split("=");if("undefined"===typeof a[e[0]])a[e[0]]=decodeURIComponent(e[1]);else if("string"===typeof a[e[0]]){var b=[a[e[0]],decodeURIComponent(e[1])];a[e[0]]=b}else a[e[0]].push(decodeURIComponent(e[1]))}return a};
function getInputs(a,d){for(var c=0;"undefined"!=typeof a[c];){if(a[c].name.toLowerCase()==d.toLowerCase())return a[c];c++}return null}function inputDate(){var a=getServerTime(),d=15*parseInt((a.getMinutes()+7.5)/15)%60,c=52<a.getMinutes()?23===a.getHours()?0:a.getHours()+1:a.getHours();return[toDouble(c)+":"+toDouble(d),a.getFullYear()+"-"+toDouble(a.getMonth()+1)+"-"+toDouble(a.getDate())]}
function getInputDate(a){return[toDouble(a.getHours())+":"+toDouble(a.getMinutes()),a.getFullYear()+"-"+toDouble(a.getMonth()+1)+"-"+toDouble(a.getDate())]}var FORM=document.getElementById("FORM"),DISPLAY_NAME_STATUS=document.getElementById("DISPLAY_NAME"),USERNAME_STATUS=document.getElementById("USERNAME"),EMAIL_STATUS=document.getElementById("EMAIL"),PASSWORD_STATUS=document.getElementById("PASSWORD"),CONFIRM_PASSWORD_STATUS=document.getElementById("CONFIRM_PASSWORD"),STATUS=document.getElementById("status");
FORM.onsubmit=function(a){a.preventDefault();register();return!1};
function register(){var a=getInputs(FORM,"DISPLAY_NAME").value,d=getInputs(FORM,"USERNAME").value,c=getInputs(FORM,"EMAIL").value,e=getInputs(FORM,"PASSWORD").value,b=getInputs(FORM,"CONFIRM_PASSWORD").value,f=!1;1>a.length||70<a.length?(DISPLAY_NAME_STATUS.innerHTML="Display Name out of bounds (1-70)",f=!0):DISPLAY_NAME_STATUS.innerHTML="";1>c.length?(EMAIL_STATUS.innerHTML="Email has to be set",f=!0):validateEmail(c)?EMAIL_STATUS.innerHTML="":(EMAIL_STATUS.innerHTML="Email invalid format",f=!0);
4>d.length||16<d.length?(d.innerHTML="Username out of bounds (4-16)",f=!0):/^\w+$/.test(d)||"_"==d.charAt(0)?d.innerHTML="":(d.innerHTML="Username can only contain letters, numbers, and underscores (underscore can not be the first character)",f=!0);5>e.length?(PASSWORD_STATUS.innerHTML="Password has to be greater then 5 characters",f=!0):PASSWORD_STATUS.innerHTML="";e!=b?(CONFIRM_PASSWORD_STATUS.innerHTML="Passwords have to match",f=!0):CONFIRM_PASSWORD_STATUS.innerHTML="";f||sendSimpleRequest("register",
"post",{DISPLAY_NAME:a,USERNAME:d,PASSWORD:e,EMAIL:c},function(a,b){a?console.log("ERROR: "+a):b.success?location.href="/":38==b.code?(console.log(encodeURIComponent(window.location.href)),STATUS.innerHTML="Email domain is not whitelisted! Learn more <a href='beta?redirect="+encodeURIComponent(window.location.href)+"'>here</a>!"):6==b.code?STATUS.innerHTML="EMAIL"==b.CONFLICT?"Email is already in use!":"Username is already in use!":(STATUS.innerHTML="Internal error creating account!",console.dir(b))})}
;
