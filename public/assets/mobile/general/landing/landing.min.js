function getURL(){return-1<window.location.href.indexOf("localhost:8081")?"http://localhost:8081/api/":"https://commservus.com/api/"}Date.prototype.addMinutes=function(a){this.setMinutes(this.getMinutes()+a);return this};function getServerTime(){var a=-5,d=new Date;d.dst()&&(a+=1);d=d.getTime()+6E4*d.getTimezoneOffset();return new Date(d+36E5*a)}
Date.prototype.stdTimezoneOffset=function(){var a=new Date(this.getFullYear(),0,1),d=new Date(this.getFullYear(),6,1);return Math.max(a.getTimezoneOffset(),d.getTimezoneOffset())};Date.prototype.dst=function(){return this.getTimezoneOffset()<this.stdTimezoneOffset()};function formatTime(a){return toDouble(a.getHours())+":"+toDouble(a.getMinutes())+":"+toDouble(a.getSeconds())+" "+toDouble(a.getMonth()+1)+"-"+toDouble(a.getDate())+"-"+toDouble(a.getFullYear())}
function getTime(){return formatTime(getServerTime())}function parseTime(a){var d=new Date,c=a.split(" ");a=c[0].split(":");c=c[1].split("-");d.setHours(a[0]);d.setMinutes(a[1]);d.setSeconds(a[2]);d.setMonth(c[0]-1);d.setDate(c[1]);d.setFullYear(c[2]);return d}function toDouble(a){return 9<a?a:"0"+a}
function sendSimpleRequest(a,d,c,e){var b=new XMLHttpRequest;if(-1<window.location.href.indexOf("localhost:8081")){b.open(d.toUpperCase(),getURL()+a);b.setRequestHeader("Content-type","application/json");if("undefined"==typeof c||null==c)try{b.send()}catch(f){}else b.send(JSON.stringify(c));b.onreadystatechange=function(){if(4===b.readyState)if(200===b.status){var a=JSON.parse(b.responseText);e(void 0,a)}else console.log(b.statusText)}}else if("withCredentials"in b){b.open(d,getURL()+a,!0);b.setRequestHeader("Content-type",
"application/json");b.withCredentials=!0;if("undefined"==typeof c||null==c)try{b.send()}catch(f){e(f)}else b.send(JSON.stringify(c));b.onreadystatechange=function(){if(4===b.readyState)if(200===b.status){var a=JSON.parse(b.responseText);e(void 0,a)}else console.log(b.statusText)}}else if("undefined"!=typeof XDomainRequest){b=new XDomainRequest;b.open(d,getURL()+a);b.setRequestHeader("Content-type","application/json");if("undefined"==typeof c||null==c)try{b.send()}catch(f){e(f)}else b.send(JSON.stringify(c));
b.onreadystatechange=function(){if(4===b.readyState)if(200===b.status){var a=JSON.parse(b.responseText);e(void 0,a)}else console.log(b.statusText)}}else e("We can't CORS",response),b=null}
function sendSimpleFileRequest(a,d,c,e){var b=new XMLHttpRequest;if(-1<window.location.href.indexOf("localhost:8081")){b.open(d.toUpperCase(),getURL()+a);if("undefined"==typeof c||null==c)try{b.send()}catch(h){}else{var f=new FormData;for(g in c)c.hasOwnProperty(g)&&f.append(g,c[g]);b.send(f)}b.onreadystatechange=function(){if(4===b.readyState)if(200===b.status){var a=JSON.parse(b.responseText);e(void 0,a)}else console.log(b.statusText)}}else if("withCredentials"in b){b.open(d,getURL()+a,!0);b.withCredentials=
!0;if("undefined"==typeof c||null==c)try{b.send()}catch(h){e(h)}else{var g=new FormData;for(f in c)c.hasOwnProperty(f)&&g.append(f,c[f]);b.send(g)}b.onreadystatechange=function(){if(4===b.readyState)if(200===b.status){var a=JSON.parse(b.responseText);e(void 0,a)}else console.log(b.statusText)}}else if("undefined"!=typeof XDomainRequest){b=new XDomainRequest;b.open(d,getURL()+a);if("undefined"==typeof c||null==c)try{b.send()}catch(h){e(h)}else{formData3=new FormData;for(key3 in c)c.hasOwnProperty(ke3y)&&
formData3.append(key3,c[key3]);b.send(formData3)}b.onreadystatechange=function(){if(4===b.readyState)if(200===b.status){var a=JSON.parse(b.responseText);e(void 0,a)}else console.log(b.statusText)}}else e("We can't CORS",response),b=null}function validateEmail(a){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(a)}
function TimeKeyDelay(){var a=null;(function(d,c,e){c.onkeyup=function(){clearTimeout(a);a=setTimeout(e,d)}}).apply(this,arguments)}var QueryString=function(){for(var a={},d=window.location.search.substring(1).split("&"),c=0;c<d.length;c++){var e=d[c].split("=");if("undefined"===typeof a[e[0]])a[e[0]]=decodeURIComponent(e[1]);else if("string"===typeof a[e[0]]){var b=[a[e[0]],decodeURIComponent(e[1])];a[e[0]]=b}else a[e[0]].push(decodeURIComponent(e[1]))}return a};
function getInputs(a,d){for(var c=0;"undefined"!=typeof a[c];){if(a[c].name.toLowerCase()==d.toLowerCase())return a[c];c++}return null}function inputDate(){var a=getServerTime(),d=15*parseInt((a.getMinutes()+7.5)/15)%60,c=52<a.getMinutes()?23===a.getHours()?0:a.getHours()+1:a.getHours();return[toDouble(c)+":"+toDouble(d),a.getFullYear()+"-"+toDouble(a.getMonth()+1)+"-"+toDouble(a.getDate())]}
function getInputDate(a){return[toDouble(a.getHours())+":"+toDouble(a.getMinutes()),a.getFullYear()+"-"+toDouble(a.getMonth()+1)+"-"+toDouble(a.getDate())]}function removeURLParameter(a,d){var c=a.split("?");if(2<=c.length){for(var e=encodeURIComponent(d)+"=",b=c[1].split(/[&;]/g),f=b.length;0<f--;)-1!==b[f].lastIndexOf(e,0)&&b.splice(f,1);a=c[0]+(0<b.length?"?"+b.join("&"):"")}return a}
var SEARCH_BAR=document.getElementById("search-bar"),MENU=document.getElementById("menu"),BLEED=document.getElementById("bleed"),LOGIN_MODAL=document.getElementById("loginModal"),SIGNUP_MODAL=document.getElementById("signupModal"),FORGOT_MODAL=document.getElementById("forgotModal"),BETA_MODAL=document.getElementById("alphaModal"),search,menu;firstLoad();
function firstLoad(){var a=QueryString().popup;"undefined"!=typeof a&&(a=a.toLowerCase(),"login"==a?openLogin():"signup"==a?openSignup():"forgot"==a?openForgot():"alpha"==a&&openBeta())}window.onclick=function(a){a.target==BLEED&&(BLEED.style.display="none",search?(SEARCH_BAR.style.display="none",search=!1):menu&&(MENU.style.display="none",menu=!1))};
function openSignup(){SIGNUP_MODAL.style.display="block";LOGIN_MODAL.style.display="none";FORGOT_MODAL.style.display="none";BETA_MODAL.style.display="none"}function openBeta(){SIGNUP_MODAL.style.display="none";LOGIN_MODAL.style.display="none";FORGOT_MODAL.style.display="none";BETA_MODAL.style.display="block"}function openSearch(){SEARCH_BAR.style.display="block";BLEED.style.display="block";MENU.style.display="none";search=!0}
function closeSearch(){SEARCH_BAR.style.display="none";BLEED.style.display="none";search=!1}function toggleMenu(){"block"==MENU.style.display?(MENU.style.display="none",BLEED.style.display="none",menu=!1):(MENU.style.display="block",BLEED.style.display="block",menu=!0)}function openLogin(){LOGIN_MODAL.style.display="block";SIGNUP_MODAL.style.display="none";FORGOT_MODAL.style.display="none";MENU.style.display="none";BLEED.style.display="none"}
function openForgot(){LOGIN_MODAL.style.display="none";SIGNUP_MODAL.style.display="none";FORGOT_MODAL.style.display="block";BETA_MODAL.style.display="none";MENU.style.display="none";BLEED.style.display="none"}var loginForm=document.getElementById("loginForm");loginForm.onsubmit=function(a){a.preventDefault();loginAction();return!1};
function loginAction(){var a=loginForm.getElementsByClassName("status")[0],d=getInputs(loginForm,"id").value,c=getInputs(loginForm,"password").value;1>d.length?a.innerHTML="Username or Email has to be filled in!":1>c.length?a.innerHTML="Password has to be filled in!":(c={PASSWORD:c},validateEmail(d)?c.EMAIL=d:c.USERNAME=d,sendSimpleRequest("login","POST",c,function(c,b){c?a.innerHTML="Client side internal error! Send help!":b.success?"undefined"!=typeof QueryString().redirect?location.href=QueryString().redirect:
location.reload():16==b.code&&(a.innerHTML="Login credentials invalid")}))}var signupForm=document.getElementById("signupForm");signupForm.onsubmit=function(a){a.preventDefault();signupAction();return!1};
function signupAction(){var a=signupForm.getElementsByClassName("status")[0],d=getInputs(signupForm,"display").value,c=getInputs(signupForm,"username").value,e=getInputs(signupForm,"email").value,b=getInputs(signupForm,"password").value,f=getInputs(signupForm,"confirm").value;1>d.length?a.innerHTML="Display name has to be set":70<d.length?a.innerHTML="Display name can't exceed 70 characters":4>c.length?a.innerHTML="Username has to be at least 4 characters":16<c.length?a.innerHTML="Username can't be more then 16 characters":
/^\w+$/.test(c)||"_"==c.charAt(0)?1>e.length?a.innerHTML="Email has to be set":validateEmail(e)?5>b.length?a.innerHTML="Password has to be at least 5 characters":b!=f?a.innerHTML="Passwords don't match":sendSimpleRequest("register","POST",{USERNAME:c,PASSWORD:b,EMAIL:e,DISPLAY_NAME:d},function(b,c){b?a.innerHTML="Client side internal error":c.success?location.reload():38==c.code?a.innerHTML="Email domain is not whitelisted! Learn more <a href='beta?redirect="+encodeURIComponent(window.location.href)+
"'>here</a>!":6==c.code?a.innerHTML="EMAIL"==c.CONFLICT?"Email is already in use!":"Username is already in use!":(a.innerHTML="Internal error while creating account!",console.dir(c))}):a.innerHTML="Email is invalid":a.innerHTML="Username can only contain numbers, letters, or underscores (not in first position)"}var forgotForm=document.getElementById("forgotForm");forgotForm.onsubmit=function(a){a.preventDefault();forgotAction();return!1};
function forgotAction(){var a=forgotForm.getElementsByClassName("status")[0],d=getInputs(forgotForm,"id").value;1>d.length?a.innerHTML="Please enter username or email":sendSimpleRequest("forgot","POST",{ID:d},function(c,d){a.innerHTML=c?"Internal client side error":d.success?"An email has been sent with more instructions":19==d.code?"Email already sent in the last 24h!":"User not found"})}
for(var modals=document.getElementsByClassName("modal"),i=0;i<modals.length;i++)(function(){var a=modals[i];a.getElementsByClassName("close")[0].onclick=function(){a.style.display="none";"undefined"!=typeof QueryString().popup&&(console.log("HERE"),window.history.pushState({},"",removeURLParameter(window.location.href,"popup")))}})();
