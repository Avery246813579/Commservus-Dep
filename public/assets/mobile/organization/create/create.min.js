function getURL(){return-1<window.location.href.indexOf("localhost:8081")?"http://localhost:8081/api/":"https://commservus.com/api/"}Date.prototype.addMinutes=function(a){this.setMinutes(this.getMinutes()+a);return this};function getServerTime(){var a=-5,d=new Date;d.dst()&&(a+=1);d=d.getTime()+6E4*d.getTimezoneOffset();return new Date(d+36E5*a)}
Date.prototype.stdTimezoneOffset=function(){var a=new Date(this.getFullYear(),0,1),d=new Date(this.getFullYear(),6,1);return Math.max(a.getTimezoneOffset(),d.getTimezoneOffset())};Date.prototype.dst=function(){return this.getTimezoneOffset()<this.stdTimezoneOffset()};function formatTime(a){return toDouble(a.getHours())+":"+toDouble(a.getMinutes())+":"+toDouble(a.getSeconds())+" "+toDouble(a.getMonth()+1)+"-"+toDouble(a.getDate())+"-"+toDouble(a.getFullYear())}
function getTime(){return formatTime(getServerTime())}function parseTime(a){var d=new Date,b=a.split(" ");a=b[0].split(":");b=b[1].split("-");d.setHours(a[0]);d.setMinutes(a[1]);d.setSeconds(a[2]);d.setMonth(b[0]-1);d.setDate(b[1]);d.setFullYear(b[2]);return d}function toDouble(a){return 9<a?a:"0"+a}
function sendSimpleRequest(a,d,b,e){var c=new XMLHttpRequest;if(-1<window.location.href.indexOf("localhost:8081")){c.open(d.toUpperCase(),getURL()+a);c.setRequestHeader("Content-type","application/json");if("undefined"==typeof b||null==b)try{c.send()}catch(f){}else c.send(JSON.stringify(b));c.onreadystatechange=function(){if(4===c.readyState)if(200===c.status){var a=JSON.parse(c.responseText);e(void 0,a)}else console.log(c.statusText)}}else if("withCredentials"in c){c.open(d,getURL()+a,!0);c.setRequestHeader("Content-type",
"application/json");c.withCredentials=!0;if("undefined"==typeof b||null==b)try{c.send()}catch(f){e(f)}else c.send(JSON.stringify(b));c.onreadystatechange=function(){if(4===c.readyState)if(200===c.status){var a=JSON.parse(c.responseText);e(void 0,a)}else console.log(c.statusText)}}else if("undefined"!=typeof XDomainRequest){c=new XDomainRequest;c.open(d,getURL()+a);c.setRequestHeader("Content-type","application/json");if("undefined"==typeof b||null==b)try{c.send()}catch(f){e(f)}else c.send(JSON.stringify(b));
c.onreadystatechange=function(){if(4===c.readyState)if(200===c.status){var a=JSON.parse(c.responseText);e(void 0,a)}else console.log(c.statusText)}}else e("We can't CORS",response),c=null}
function sendSimpleFileRequest(a,d,b,e){var c=new XMLHttpRequest;if(-1<window.location.href.indexOf("localhost:8081")){c.open(d.toUpperCase(),getURL()+a);if("undefined"==typeof b||null==b)try{c.send()}catch(h){}else{var f=new FormData;for(g in b)b.hasOwnProperty(g)&&f.append(g,b[g]);c.send(f)}c.onreadystatechange=function(){if(4===c.readyState)if(200===c.status){var a=JSON.parse(c.responseText);e(void 0,a)}else console.log(c.statusText)}}else if("withCredentials"in c){c.open(d,getURL()+a,!0);c.withCredentials=
!0;if("undefined"==typeof b||null==b)try{c.send()}catch(h){e(h)}else{var g=new FormData;for(f in b)b.hasOwnProperty(f)&&g.append(f,b[f]);c.send(g)}c.onreadystatechange=function(){if(4===c.readyState)if(200===c.status){var a=JSON.parse(c.responseText);e(void 0,a)}else console.log(c.statusText)}}else if("undefined"!=typeof XDomainRequest){c=new XDomainRequest;c.open(d,getURL()+a);if("undefined"==typeof b||null==b)try{c.send()}catch(h){e(h)}else{formData3=new FormData;for(key3 in b)b.hasOwnProperty(ke3y)&&
formData3.append(key3,b[key3]);c.send(formData3)}c.onreadystatechange=function(){if(4===c.readyState)if(200===c.status){var a=JSON.parse(c.responseText);e(void 0,a)}else console.log(c.statusText)}}else e("We can't CORS",response),c=null}function validateEmail(a){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(a)}
function TimeKeyDelay(){var a=null;(function(d,b,e){b.onkeyup=function(){clearTimeout(a);a=setTimeout(e,d)}}).apply(this,arguments)}var QueryString=function(){for(var a={},d=window.location.search.substring(1).split("&"),b=0;b<d.length;b++){var e=d[b].split("=");if("undefined"===typeof a[e[0]])a[e[0]]=decodeURIComponent(e[1]);else if("string"===typeof a[e[0]]){var c=[a[e[0]],decodeURIComponent(e[1])];a[e[0]]=c}else a[e[0]].push(decodeURIComponent(e[1]))}return a};
function getInputs(a,d){for(var b=0;"undefined"!=typeof a[b];){if(a[b].name.toLowerCase()==d.toLowerCase())return a[b];b++}return null}function inputDate(){var a=getServerTime(),d=15*parseInt((a.getMinutes()+7.5)/15)%60,b=52<a.getMinutes()?23===a.getHours()?0:a.getHours()+1:a.getHours();return[toDouble(b)+":"+toDouble(d),a.getFullYear()+"-"+toDouble(a.getMonth()+1)+"-"+toDouble(a.getDate())]}
function getInputDate(a){return[toDouble(a.getHours())+":"+toDouble(a.getMinutes()),a.getFullYear()+"-"+toDouble(a.getMonth()+1)+"-"+toDouble(a.getDate())]}function removeURLParameter(a,d){var b=a.split("?");if(2<=b.length){for(var e=encodeURIComponent(d)+"=",c=b[1].split(/[&;]/g),f=c.length;0<f--;)-1!==c[f].lastIndexOf(e,0)&&c.splice(f,1);a=b[0]+(0<c.length?"?"+c.join("&"):"")}return a}
var SEARCH_BAR=document.getElementById("search-bar"),MENU=document.getElementById("menu"),BLEED=document.getElementById("bleed"),LOGIN_MODAL=document.getElementById("loginModal"),SIGNUP_MODAL=document.getElementById("signupModal"),FORGOT_MODAL=document.getElementById("forgotModal"),BETA_MODAL=document.getElementById("alphaModal"),SEARCH_BAR_TOP=document.getElementById("searchBarTop"),SEARCH_RESULT=document.getElementById("searchResult"),search,menu;
window.onclick=function(a){a.target==BLEED&&(BLEED.style.display="none",SEARCH_RESULT.style.display="none",search?(SEARCH_BAR.style.display="none",search=!1):menu&&(MENU.style.display="none",menu=!1))};function openSignup(){SIGNUP_MODAL.style.display="block";LOGIN_MODAL.style.display="none";FORGOT_MODAL.style.display="none";BETA_MODAL.style.display="none"}
function openBeta(){SIGNUP_MODAL.style.display="none";LOGIN_MODAL.style.display="none";FORGOT_MODAL.style.display="none";BETA_MODAL.style.display="block"}function openSearch(){SEARCH_BAR.style.display="block";BLEED.style.display="block";MENU.style.display="none";search=!0}function closeSearch(){SEARCH_BAR.style.display="none";BLEED.style.display="none";SEARCH_RESULT.style.display="none";search=!1}
function toggleMenu(){if("block"==MENU.style.display)MENU.style.display="none",BLEED.style.display="none",menu=!1;else{if(loggedIn){for(var a=MENU.getElementsByClassName("nLog"),d=MENU.getElementsByClassName("log"),b=0;b<a.length;b++)a[b].style.display="none";for(a=0;a<d.length;a++)d[a].style.display="block"}else{a=MENU.getElementsByClassName("nLog");d=MENU.getElementsByClassName("log");for(b=0;b<a.length;b++)a[b].style.display="block";for(a=0;a<d.length;a++)d[a].style.display="none"}MENU.style.display=
"block";BLEED.style.display="block";menu=!0}}function openLogin(){LOGIN_MODAL.style.display="block";SIGNUP_MODAL.style.display="none";FORGOT_MODAL.style.display="none";MENU.style.display="none";BLEED.style.display="none"}function openForgot(){LOGIN_MODAL.style.display="none";SIGNUP_MODAL.style.display="none";FORGOT_MODAL.style.display="block";BETA_MODAL.style.display="none";MENU.style.display="none";BLEED.style.display="none"}var loginForm=document.getElementById("loginForm");
loginForm.onsubmit=function(a){a.preventDefault();loginAction();return!1};
function loginAction(){var a=loginForm.getElementsByClassName("status")[0],d=getInputs(loginForm,"id").value,b=getInputs(loginForm,"password").value;1>d.length?a.innerHTML="Username or Email has to be filled in!":1>b.length?a.innerHTML="Password has to be filled in!":(b={PASSWORD:b},validateEmail(d)?b.EMAIL=d:b.USERNAME=d,sendSimpleRequest("login","POST",b,function(b,c){b?a.innerHTML="Client side internal error! Send help!":c.success?"undefined"!=typeof QueryString().redirect?location.href=QueryString().redirect:
location.reload():16==c.code&&(a.innerHTML="Login credentials invalid")}))}var signupForm=document.getElementById("signupForm");signupForm.onsubmit=function(a){a.preventDefault();signupAction();return!1};
function signupAction(){var a=signupForm.getElementsByClassName("status")[0],d=getInputs(signupForm,"display").value,b=getInputs(signupForm,"username").value,e=getInputs(signupForm,"email").value,c=getInputs(signupForm,"password").value,f=getInputs(signupForm,"confirm").value;1>d.length?a.innerHTML="Display name has to be set":70<d.length?a.innerHTML="Display name can't exceed 70 characters":4>b.length?a.innerHTML="Username has to be at least 4 characters":16<b.length?a.innerHTML="Username can't be more then 16 characters":
/^\w+$/.test(b)||"_"==b.charAt(0)?1>e.length?a.innerHTML="Email has to be set":validateEmail(e)?5>c.length?a.innerHTML="Password has to be at least 5 characters":c!=f?a.innerHTML="Passwords don't match":sendSimpleRequest("register","POST",{USERNAME:b,PASSWORD:c,EMAIL:e,DISPLAY_NAME:d},function(c,b){c?a.innerHTML="Client side internal error":b.success?location.reload():38==b.code?a.innerHTML="Email domain is not whitelisted! Learn more <a href='beta?redirect="+encodeURIComponent(window.location.href)+
"'>here</a>!":6==b.code?a.innerHTML="EMAIL"==b.CONFLICT?"Email is already in use!":"Username is already in use!":(a.innerHTML="Internal error while creating account!",console.dir(b))}):a.innerHTML="Email is invalid":a.innerHTML="Username can only contain numbers, letters, or underscores (not in first position)"}var forgotForm=document.getElementById("forgotForm");forgotForm.onsubmit=function(a){a.preventDefault();forgotAction();return!1};
function forgotAction(){var a=forgotForm.getElementsByClassName("status")[0],d=getInputs(forgotForm,"id").value;1>d.length?a.innerHTML="Please enter username or email":sendSimpleRequest("forgot","POST",{ID:d},function(b,d){a.innerHTML=b?"Internal client side error":d.success?"An email has been sent with more instructions":19==d.code?"Email already sent in the last 24h!":"User not found"})}
for(var modals=document.getElementsByClassName("modal"),i=0;i<modals.length;i++)(function(){var a=modals[i];a.getElementsByClassName("close")[0].onclick=function(){a.style.display="none";"undefined"!=typeof QueryString().popup&&window.history.pushState({},"",removeURLParameter(window.location.href,"popup"))}})();recent();
new TimeKeyDelay(500,SEARCH_BAR_TOP,function(){""==SEARCH_BAR_TOP.value.trim()?recent():sendSimpleRequest("find/"+SEARCH_BAR_TOP.value,"GET",{},function(a,d){if(a)console.log("INTERNAL ERROR");else if(d.success){var b=d.data,e="";resetData();for(var c=0;c<b.length;c++){var f=b[c];"undefined"!=typeof sData[f.ID]?(sData[f.ID].NAME=f.NAME,sData[f.ID].DUPE=!0):sData[f.ID]=f;e=0==f.TYPE?e+('<a href="organization/'+f.ID+'" onclick="update('+f.ID+", "+f.TYPE+')" class="nLog"> <div class="item"> <i class="fa fa-calendar-o icon"></i> <div class="content"> '+
f.NAME+" </div> </div> </a>"):e+('<a href="event/'+f.ID+'" onclick="update('+f.ID+", "+f.TYPE+')" class="nLog"> <div class="item"> <i class="fa fa-users icon"></i> <div class="content"> '+f.NAME+" </div> </div> </a>")}1>b.length?SEARCH_RESULT.innerHTML='<a> <div class="item"> <i class="fa fa-exclamation  icon"></i> <div class="content"> Nothing found </div> </div> </a>':(SEARCH_RESULT.style.display="block",SEARCH_RESULT.innerHTML=e)}else console.dir(d)})});var sData={},pre="";
function resetData(){sData={};try{var a=JSON.parse(localStorage.SEARCHES)}catch(b){a=[]}"undefined"==typeof a&&(a=[]);a.constructor!==Array&&(a=[]);for(var d=0;d<a.length;d++)sData[a[d].ID]=a[d]}
function update(a,d){var b=sData[a];try{var e=JSON.parse(localStorage.SEARCHES)}catch(f){e=[]}"undefined"==typeof e&&(e=[]);e.constructor!==Array&&(e=[]);if("undefined"==typeof b.DUPE)e.push(b);else for(var c=0;c<e.length;c++)if(e[c].ID==b.ID&&e[c].TYPE==b.TYPE){e.splice(c,1);e.push(b);break}localStorage.SEARCHES=JSON.stringify(e)}
function recent(a){"undefined"!=typeof a&&(pre=a);try{var d=JSON.parse(localStorage.SEARCHES)}catch(c){d=[]}"undefined"==typeof d&&(d=[]);SEARCH_RESULT.innerHTML="";a=d.length;a=5<d.length?a-5:0;if(1>d.length)SEARCH_RESULT.innerHTML='<div class="_row">No past searches</div>';else{sData={};for(var b=d.length-1;b>=a;b--){var e=d[b];sData[e.ID]=e;sData[e.ID].DUPE=!0;SEARCH_RESULT.innerHTML=0==e.TYPE?SEARCH_RESULT.innerHTML+('<a href="organization/'+e.ID+'" onclick="update('+e.ID+", "+e.TYPE+')" class="nLog"> <div class="item"> <i class="fa fa-calendar-o icon"></i> <div class="content"> '+
e.NAME+" </div> </div> </a>"):SEARCH_RESULT.innerHTML+('<a href="event/'+e.ID+'" onclick="update('+e.ID+", "+e.TYPE+')" class="nLog"> <div class="item"> <i class="fa fa-users icon"></i> <div class="content"> '+e.NAME+" </div> </div> </a>")}}}
function createOrg(){var a=document.getElementById("displayInput").value,d=document.getElementById("usernameInput").value,b=document.getElementById("descriptionInput").value,e=document.getElementById("typeInput").value,c=document.getElementById("status");1>a.length?c.innerHTML="Name has to be set.":64<a.length?c.innerHTML="Name can't be more then 64 characters":1>d.length?c.innerHTML="Username has to be set.":5>d.length?c.innerHTML="Username ahs to be at least 5 characters":16<d.length?c.innerHTML=
"Username can only be 16 characters at most":/^\w+$/.test(d)||"_"==d.charAt(0)?1>b.length?c.innerHTML="A description has to be set":0!=e&&1!=e?c.innerHTML="Internal error? Code injection?":(sendSimpleRequest("/organization","POST",{NAME:a,DESCRIPTION:b,TYPE:e,USERNAME:d},function(a,b){a?c.innerHTML="Internal Client Error":b.success?setTimeout(function(){location.href="organization/"+b.data.id},250):c.innerHTML=b.code?"You already have an organization":"Internal Error"}),console.log(e)):c.innerHTML=
"Username can only contain numbers, letters, or underscores (not in first position)"};
